<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <title>tacotron端到端语音合成</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="../stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="../stylesheets/github-light.css" media="screen">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-5289681693639345",
            enable_page_level_ads: true
        });
    </script>
</head>
<body>
<section class="page-header">
    <h1 class="project-name">Eric-sung.GitHub.io</h1>
    <h2 class="project-tagline"></h2>
</section>

<a name="547"/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%;position: relative;"><div style="outline:0px;box-sizing:border-box;"><div style="box-sizing:inherit;outline:0px;font-family:&quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:1.57143;background-color:rgb(245, 246, 247);color:rgb(51, 51, 51);"><div style="outline:0px;box-sizing:border-box;"><span style="box-sizing:inherit;outline:0px;"><div style="box-sizing:inherit;outline:0px;background:rgb(255, 255, 255);box-shadow:rgba(0, 0, 0, 0.05) 0px 2px 4px 0px;">
	<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;margin-bottom:16px;">
			<span style="border-radius:50%;display:inline-block;width:26px;height:26px;line-height:26px;text-align:center;font-size:12px;outline:0px;box-sizing:inherit;border:1px solid rgb(244, 206, 208);color:rgb(202, 12, 22);margin-right:8px;margin-top:4px;float:left;">原</span>		<h1 style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-size:24px;word-break:break-all;">TACOTRON:端到端的语音合成</h1>
	</div>
	<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;padding-bottom:14px;border-bottom:1px solid rgb(227, 227, 227);">
		<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;color:rgb(133, 133, 133);display:flex;">
						<span style="box-sizing:inherit;outline:0px;margin-right:14px;color:rgb(133, 133, 133);">置顶</span>
												<span style="box-sizing:inherit;outline:0px;margin-right:14px;">2017年07月09日 20:50:53</span>
			<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;margin-left:auto;float:right;">
				<span style="box-sizing:inherit;outline:0px;margin-right:14px;">阅读数：6261</span>
											</div>
		</div>
	</div>
	<div style="box-sizing:inherit;outline:0px;display:block;position:relative;padding-top:16px;">
		<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;word-break:break-all;">
                    <div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;word-break:break-all;">
                <p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  由于最近在学习语音识别和语音合成方面的内容，整理了一些东西，本文为论文<a href="https://arxiv.org/abs/1703.10135" rel="nofollow" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;" target="_blank">tacotron</a>的笔记。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  tacotron主要是将文本转化为语音，采用的结构为基于encoder-decoder的Seq2Seq的结构。其中还引入了注意机制（attention mechanism）。在对模型的结构进行介绍之前，先对encoder-decoder架构和attention mechanism进行简单的介绍。其中纯属个人理解，如有错误，请多多包含。</p>



<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);font-weight:700;line-height:32px;word-break:break-all;"><a name="t0" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;"></a>1.基于encoder-decoder的seq2seq的架构</h2>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  由于在机器翻译中，我们输入的句子长度不是固定的。而对于一般的模型而言，输入的特征通常是一个固定大小的矩阵，这样就限制了我们输入的长度必须是一致的。但是这在翻译中很难保证，而Seq2Seq的结构正是为了解决这个问题。它的输入序列和输出序列的长度是不固定的。通常我们把RNN的输入称为“上下文”（context），我们希望通过encoder来产生此上下文的表示C。C有可能是一个概括了输入序列 <span style="word-spacing:normal;word-break:break-all;outline:0px;display:inline;font-style:normal;font-weight:normal;line-height:normal;font-size:100%;text-indent:0px;text-align:left;text-transform:none;letter-spacing:normal;box-sizing:border-box;word-wrap:normal;white-space:nowrap;float:none;direction:ltr;max-width:none;max-height:none;min-width:0px;min-height:0px;border:0px;padding:0px;margin:0px;position:relative;"><span style="max-height:none;transition:none;outline:0px;box-sizing:border-box;min-height:0px;padding:0px;max-width:none;border:0px;min-width:0px;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;white-space:nowrap;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:12.034em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:10.003em;height:0px;font-size:120%;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(1.096em, 1009.95em, 2.555em, -999.997em);top:-2.133em;left:0em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">X<span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;overflow:hidden;height:1px;width:0.003em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.263em;">=</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.263em;">{</span><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.565em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.44em, 1000.52em, 4.169em, -999.997em);top:-4.008em;left:0em;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">x</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-4.372em;left:0.576em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">(</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">1</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">)</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span></span></span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;">,</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;padding-left:0.159em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.565em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.44em, 1000.52em, 4.169em, -999.997em);top:-4.008em;left:0em;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">x</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-4.372em;left:0.576em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">(</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">2</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">)</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span></span></span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;">.</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.159em;">.</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.159em;">.</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;padding-left:0.159em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.982em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.44em, 1000.52em, 4.169em, -999.997em);top:-4.008em;left:0em;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">x</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-4.372em;left:0.576em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">(</span><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0.784em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.544em, 1000.42em, 4.169em, -999.997em);top:-4.008em;left:0em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">n</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-3.904em;left:0.419em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:50%;font-family:MathJax_Math-italic;">x</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">)</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span></span></span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;">}</span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:2.138em;"></span></span></span><span style="vertical-align:-0.372em;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;overflow:hidden;border-left:0px solid;width:0px;height:1.503em;"></span></span></span><span style="border:0px;transition:none;outline:0px;top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);user-select:none;box-sizing:border-box;display:block;word-break:break-all;text-decoration:none;line-height:normal;vertical-align:0px;margin:0px;position:absolute;overflow:hidden;width:1px;height:1px;padding:1px 0px 0px;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">X</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">=</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">{</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">x</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">(</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">1</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">)</span></span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">,</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">x</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">(</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">2</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">)</span></span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">.</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">.</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">.</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">x</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">(</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">n</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">x</span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">)</span></span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">}</span></span></span></span> 的向量或者向量序列。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">其网络结构如下图所示：</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;"></p><center style="outline:0px;box-sizing:border-box;word-break:break-all;"><img src="TACOTRON端到端的语音合成 - CSDN博客_files/SouthEast" type="image/png" data-filename="SouthEast" height="662" style="outline:0px;box-sizing:border-box;margin:24px 0px;word-break:break-all;max-width:100%;cursor:zoom-in;" title="" width="684"/></center><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;"></p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  在Seq2Seq网络中通常分为两个部分：</p>

<ol style="outline:0px;list-style:none;box-sizing:border-box;padding:0px;margin:0px 0px 24px;word-break:break-all;">
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;"><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">编码器（encoder）：它主要是处理RNN的输入序列，将最后一个RNN的单元状态来作为最终的输出的上下文C。</p></li>
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;"><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">解码器（decoder）：它以编码器的输出C作为输入，以固定长度的向量作为条件，产生输出序列  <span style="word-spacing:normal;word-break:break-all;outline:0px;display:inline;font-style:normal;font-weight:normal;line-height:normal;font-size:100%;text-indent:0px;text-align:left;text-transform:none;letter-spacing:normal;box-sizing:border-box;word-wrap:normal;white-space:nowrap;float:none;direction:ltr;max-width:none;max-height:none;min-width:0px;min-height:0px;border:0px;padding:0px;margin:0px;position:relative;"><span style="max-height:none;transition:none;outline:0px;box-sizing:border-box;min-height:0px;padding:0px;max-width:none;border:0px;min-width:0px;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;white-space:nowrap;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:11.669em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:9.69em;height:0px;font-size:120%;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(1.096em, 1009.64em, 2.555em, -999.997em);top:-2.133em;left:0em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">Y<span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;overflow:hidden;height:1px;width:0.159em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.263em;">=</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.263em;">{</span><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.513em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.44em, 1000.52em, 4.378em, -999.997em);top:-4.008em;left:0em;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">y<span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;overflow:hidden;height:1px;width:0.003em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-4.372em;left:0.576em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">(</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">1</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">)</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span></span></span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;">,</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;padding-left:0.159em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.513em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.44em, 1000.52em, 4.378em, -999.997em);top:-4.008em;left:0em;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">y<span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;overflow:hidden;height:1px;width:0.003em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-4.372em;left:0.576em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">(</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">2</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">)</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span></span></span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;">.</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.159em;">.</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.159em;">.</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;padding-left:0.159em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.878em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.44em, 1000.52em, 4.378em, -999.997em);top:-4.008em;left:0em;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">y<span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;overflow:hidden;height:1px;width:0.003em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-4.372em;left:0.576em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">(</span><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0.732em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.544em, 1000.42em, 4.169em, -999.997em);top:-4.008em;left:0em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">n</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-3.904em;left:0.419em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:50%;font-family:MathJax_Math-italic;">y<span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;overflow:hidden;height:1px;width:0.003em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">)</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span></span></span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;">}</span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:2.138em;"></span></span></span><span style="vertical-align:-0.372em;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;overflow:hidden;border-left:0px solid;width:0px;height:1.503em;"></span></span></span><span style="border:0px;transition:none;outline:0px;top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);user-select:none;box-sizing:border-box;display:block;word-break:break-all;text-decoration:none;line-height:normal;vertical-align:0px;margin:0px;position:absolute;overflow:hidden;width:1px;height:1px;padding:1px 0px 0px;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">Y</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">=</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">{</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">y</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">(</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">1</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">)</span></span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">,</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">y</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">(</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">2</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">)</span></span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">.</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">.</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">.</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">y</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">(</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">n</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">y</span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">)</span></span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">}</span></span></span></span>。</p></li>
</ol>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  这种encoder-decoder的架构的好处在于，它的输入序列的长度不需要和输出序列的长度保持一致。而这个架构也有一个不足之处就是encoder的输出上下文C的维度太小，因此它很难去概括一个长序列的所有语义细节信息。一个解决办法就是让C成为一个可变长度的序列，并引入注意机制（attention mechanism）。</p>



<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);font-weight:700;line-height:32px;word-break:break-all;"><a name="t1" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;"></a>2.注意机制（attention mechanism）</h2>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  上文中提及到的Seq2Seq模型中，模型每次将encoder的输出作为上下文向量（概括了文本的所有信息的向量）输入到decoder中。这样我们在每次生成语音的时候，所使用的上下文向量是相同的，这样就不太好。 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
  为什么会说这样不太好呢，举一个简单的例子：</p>

<ul style="outline:0px;list-style:none;box-sizing:border-box;padding:0px;margin:0px 0px 24px;word-break:break-all;">
<li style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 0px 32px;list-style-type:disc;word-break:break-all;">如果输入的文本为：he had read this book. 那么模型在生成“he”这个单词中h的发音时，重点关注的应该是h、e以及空格。而在发read这个单词的ea部分的时候，则需要关注到之前的had 以及 read本身这两个单词。因为read的现在时和过去式长一样，但发音不相同。所以我们模型在每次生成语音时所关注的重点是不一样的，因此需要引入到attention机制。</li>
</ul>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  还有一个问题就是使用固定长度大小的向量来概括一个较长句子的所有语义细节是十分困难的。一种高效的方法就是先读取完整个句子，来获得正在表达的上下文与其相关的焦点词，然后再每一次翻译一个词，在翻译单个词语的时候聚焦于句子的不同部分，来收集产生本次输出所需要的语义细节。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">注意机制主要包括三个部分：</p>

<ol style="outline:0px;list-style:none;box-sizing:border-box;padding:0px;margin:0px 0px 24px;word-break:break-all;">
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;"><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">编码器：它用于读取原始数据（句子中的单词），并将其转化成分布式的表示，其中一个特征向量与一个单词相互对应，一般使用的结构有RNN，LSTM，GRU，bi-RNN等等；</p></li>
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;"><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">存储器：主要用于存储编码器输出的特征向量列表；</p></li>
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;"><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">解码器：利用存储器的内容，顺序的执行任务，每次任务聚焦于某个or几个（具有不同权重）的内容；</p></li>
</ol>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">注意机制的结构如下图所示：</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;"></p><center style="outline:0px;box-sizing:border-box;word-break:break-all;"><img src="TACOTRON端到端的语音合成 - CSDN博客_files/SouthEast [1]" type="image/png" data-filename="SouthEast" height="516" style="outline:0px;box-sizing:border-box;margin:24px 0px;word-break:break-all;max-width:100%;cursor:zoom-in;" title="" width="688"/></center><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;"></p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">上下文向量 <span style="word-spacing:normal;word-break:break-all;outline:0px;display:inline;font-style:normal;font-weight:normal;line-height:normal;font-size:100%;text-indent:0px;text-align:left;text-transform:none;letter-spacing:normal;box-sizing:border-box;word-wrap:normal;white-space:nowrap;float:none;direction:ltr;max-width:none;max-height:none;min-width:0px;min-height:0px;border:0px;padding:0px;margin:0px;position:relative;"><span style="max-height:none;transition:none;outline:0px;box-sizing:border-box;min-height:0px;padding:0px;max-width:none;border:0px;min-width:0px;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;white-space:nowrap;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0.523em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0.419em;height:0px;font-size:120%;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(1.565em, 1000.42em, 2.294em, -999.997em);top:-2.133em;left:0em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">c</span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:2.138em;"></span></span></span><span style="vertical-align:-0.059em;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;overflow:hidden;border-left:0px solid;width:0px;height:0.691em;"></span></span></span><span style="border:0px;transition:none;outline:0px;top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);user-select:none;box-sizing:border-box;display:block;word-break:break-all;text-decoration:none;line-height:normal;vertical-align:0px;margin:0px;position:absolute;overflow:hidden;width:1px;height:1px;padding:1px 0px 0px;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">c</span></span></span></span> 的计算公式为： <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
</p><center style="outline:0px;box-sizing:border-box;word-break:break-all;"><span style="word-spacing:normal;word-break:break-all;outline:0px;display:inline;font-style:normal;font-weight:normal;line-height:normal;font-size:100%;text-indent:0px;text-align:left;text-transform:none;letter-spacing:normal;box-sizing:border-box;word-wrap:normal;white-space:nowrap;float:none;direction:ltr;max-width:none;max-height:none;min-width:0px;min-height:0px;border:0px;padding:0px;margin:0px;position:relative;"><span style="max-height:none;transition:none;outline:0px;box-sizing:border-box;min-height:0px;padding:0px;max-width:none;border:0px;min-width:0px;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;white-space:nowrap;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:8.693em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:7.205em;height:0px;font-size:120%;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(1.074em, 1007.21em, 2.682em, -999.997em);top:-2.199em;left:0em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">c</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.301em;">=</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;padding-left:0.301em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:2.265em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.039em, 1001.01em, 4.408em, -999.997em);top:-3.985em;left:0em;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0em;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Size1;">∑</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.336em, 1000.6em, 4.17em, -999.997em);top:-4.461em;left:1.074em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">T<span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;overflow:hidden;height:1px;width:0.063em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.336em, 1001.25em, 4.17em, -999.997em);top:-3.688em;left:1.074em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">t</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">=</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">1</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span></span></span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;padding-left:0.182em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.551em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.396em, 1000.6em, 4.17em, -999.997em);top:-3.985em;left:0em;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">α</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-4.342em;left:0.658em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">(</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">t</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">)</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span></span></span><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.432em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.098em, 1000.54em, 4.17em, -999.997em);top:-3.985em;left:0em;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">h</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-4.342em;left:0.598em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">(</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">t</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">)</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span></span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:2.205em;"></span></span></span><span style="vertical-align:-0.425em;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;overflow:hidden;border-left:0px solid;width:0px;height:1.646em;"></span></span></span><span style="border:0px;transition:none;outline:0px;top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);user-select:none;box-sizing:border-box;display:block;word-break:break-all;text-decoration:none;line-height:normal;vertical-align:0px;margin:0px;position:absolute;overflow:hidden;width:1px;height:1px;padding:1px 0px 0px;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">c</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">=</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">∑</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">=</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">1</span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">T</span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">α</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">(</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">)</span></span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">h</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">(</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">)</span></span></span></span></span></span></center><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;"></p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">其中<span style="word-spacing:normal;word-break:break-all;outline:0px;display:inline;font-style:normal;font-weight:normal;line-height:normal;font-size:100%;text-indent:0px;text-align:left;text-transform:none;letter-spacing:normal;box-sizing:border-box;word-wrap:normal;white-space:nowrap;float:none;direction:ltr;max-width:none;max-height:none;min-width:0px;min-height:0px;border:0px;padding:0px;margin:0px;position:relative;"><span style="max-height:none;transition:none;outline:0px;box-sizing:border-box;min-height:0px;padding:0px;max-width:none;border:0px;min-width:0px;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;white-space:nowrap;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.773em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.461em;height:0px;font-size:120%;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(1.096em, 1001.46em, 2.294em, -999.997em);top:-2.133em;left:0em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.461em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.18em, 1000.58em, 4.169em, -999.997em);top:-4.008em;left:0em;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">h</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-4.372em;left:0.576em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">(</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">t</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">)</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span></span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:2.138em;"></span></span></span><span style="vertical-align:-0.059em;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;overflow:hidden;border-left:0px solid;width:0px;height:1.191em;"></span></span></span><span style="border:0px;transition:none;outline:0px;top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);user-select:none;box-sizing:border-box;display:block;word-break:break-all;text-decoration:none;line-height:normal;vertical-align:0px;margin:0px;position:absolute;overflow:hidden;width:1px;height:1px;padding:1px 0px 0px;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">h</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">(</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">)</span></span></span></span></span></span>为编码器输出的特征向量（如果在encoder中使用的是RNN，那么就是RNN中隐藏层的状态S），<span style="word-spacing:normal;word-break:break-all;outline:0px;display:inline;font-style:normal;font-weight:normal;line-height:normal;font-size:100%;text-indent:0px;text-align:left;text-transform:none;letter-spacing:normal;box-sizing:border-box;word-wrap:normal;white-space:nowrap;float:none;direction:ltr;max-width:none;max-height:none;min-width:0px;min-height:0px;border:0px;padding:0px;margin:0px;position:relative;"><span style="max-height:none;transition:none;outline:0px;box-sizing:border-box;min-height:0px;padding:0px;max-width:none;border:0px;min-width:0px;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;white-space:nowrap;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.721em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.409em;height:0px;font-size:120%;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(1.096em, 1001.41em, 2.294em, -999.997em);top:-2.133em;left:0em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.409em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.44em, 1000.52em, 4.169em, -999.997em);top:-4.008em;left:0em;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">a</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-4.372em;left:0.523em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">(</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">t</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">)</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:4.013em;"></span></span></span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:2.138em;"></span></span></span><span style="vertical-align:-0.059em;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;overflow:hidden;border-left:0px solid;width:0px;height:1.191em;"></span></span></span><span style="border:0px;transition:none;outline:0px;top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);user-select:none;box-sizing:border-box;display:block;word-break:break-all;text-decoration:none;line-height:normal;vertical-align:0px;margin:0px;position:absolute;overflow:hidden;width:1px;height:1px;padding:1px 0px 0px;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">a</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">(</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">)</span></span></span></span></span></span>为权重。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">需要在对这个权重向量做一些解释，这个权重向量在decoder每次进行预测时都不一样，计算方法如下： <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
</p><center style="outline:0px;box-sizing:border-box;word-break:break-all;"> <span style="word-spacing:normal;word-break:break-all;outline:0px;display:inline;font-style:normal;font-weight:normal;line-height:normal;font-size:100%;text-indent:0px;text-align:left;text-transform:none;letter-spacing:normal;box-sizing:border-box;word-wrap:normal;white-space:nowrap;float:none;direction:ltr;max-width:none;max-height:none;min-width:0px;min-height:0px;border:0px;padding:0px;margin:0px;position:relative;"><span style="max-height:none;transition:none;outline:0px;box-sizing:border-box;min-height:0px;padding:0px;max-width:none;border:0px;min-width:0px;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;white-space:nowrap;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:8.813em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:7.324em;height:0px;font-size:120%;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(0.896em, 1007.32em, 3.217em, -999.997em);top:-2.199em;left:0em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.253em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.396em, 1000.6em, 4.17em, -999.997em);top:-3.985em;left:0em;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">α</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-3.807em;left:0.658em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">i</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">j</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.301em;">=</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;padding-left:0.301em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="vertical-align:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;width:4.467em;height:0px;margin-right:0.122em;margin-left:0.122em;"><span style="vertical-align:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;clip:rect(3.277em, 1002.32em, 4.348em, -999.997em);top:-4.64em;left:50%;margin-left:-1.188em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">e</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">x</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">p</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">(</span><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0.777em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.515em, 1000.3em, 4.17em, -999.997em);top:-3.985em;left:0em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">e</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-3.866em;left:0.36em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:50%;font-family:MathJax_Math-italic;">i</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:50%;font-family:MathJax_Math-italic;">j</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">)</span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span><span style="vertical-align:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;clip:rect(3.158em, 1004.29em, 4.348em, -999.997em);top:-3.39em;left:50%;margin-left:-2.14em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.729em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.277em, 1000.72em, 4.348em, -999.997em);top:-3.985em;left:0em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0em;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Size1;">∑</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.455em, 1000.42em, 4.17em, -999.997em);top:-4.342em;left:0.777em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:50%;font-family:MathJax_Math-italic;">T<span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;overflow:hidden;height:1px;width:0.063em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.455em, 1000.96em, 4.17em, -999.997em);top:-3.807em;left:0.777em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:50%;font-family:MathJax_Math-italic;">k</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:50%;font-family:MathJax_Main;">=</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:50%;font-family:MathJax_Main;">1</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;padding-left:0.241em;">e</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">x</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">p</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">(</span><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0.836em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.515em, 1000.3em, 4.17em, -999.997em);top:-3.985em;left:0em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">e</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-3.866em;left:0.36em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:50%;font-family:MathJax_Math-italic;">i</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:50%;font-family:MathJax_Math-italic;">k</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Main;">)</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(0.836em, 1004.47em, 1.253em, -999.997em);top:-1.307em;left:0em;"><span style="vertical-align:0em;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;overflow:hidden;border-top:1.3px solid;width:4.467em;height:0px;"></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:1.074em;"></span></span></span></span></span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:2.205em;"></span></span></span><span style="vertical-align:-1.068em;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;overflow:hidden;border-left:0px solid;width:0px;height:2.504em;"></span></span></span><span style="border:0px;transition:none;outline:0px;top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);user-select:none;box-sizing:border-box;display:block;word-break:break-all;text-decoration:none;line-height:normal;vertical-align:0px;margin:0px;position:absolute;overflow:hidden;width:1px;height:1px;padding:1px 0px 0px;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">α</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">i</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">j</span></span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">=</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">e</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">x</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">p</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">(</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">e</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">i</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">j</span></span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">)</span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">∑</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">k</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">=</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">1</span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">T</span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">e</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">x</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">p</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">(</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">e</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">i</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">k</span></span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">)</span></span></span></span></span></span></span></center> <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
其中的 <span style="word-spacing:normal;word-break:break-all;outline:0px;display:inline;font-style:normal;font-weight:normal;line-height:normal;font-size:100%;text-indent:0px;text-align:left;text-transform:none;letter-spacing:normal;box-sizing:border-box;word-wrap:normal;white-space:nowrap;float:none;direction:ltr;max-width:none;max-height:none;min-width:0px;min-height:0px;border:0px;padding:0px;margin:0px;position:relative;"><span style="max-height:none;transition:none;outline:0px;box-sizing:border-box;min-height:0px;padding:0px;max-width:none;border:0px;min-width:0px;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;white-space:nowrap;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.313em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.074em;height:0px;font-size:120%;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(1.61em, 1001.07em, 2.682em, -999.997em);top:-2.199em;left:0em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:1.074em;height:0px;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(3.396em, 1000.42em, 4.17em, -999.997em);top:-3.985em;left:0em;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">e</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;top:-3.807em;left:0.479em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">i</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-size:70.7%;font-family:MathJax_Math-italic;">j</span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:3.991em;"></span></span></span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:2.205em;"></span></span></span><span style="vertical-align:-0.425em;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;overflow:hidden;border-left:0px solid;width:0px;height:1.004em;"></span></span></span><span style="border:0px;transition:none;outline:0px;top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);user-select:none;box-sizing:border-box;display:block;word-break:break-all;text-decoration:none;line-height:normal;vertical-align:0px;margin:0px;position:absolute;overflow:hidden;width:1px;height:1px;padding:1px 0px 0px;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">e</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">i</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">j</span></span></span></span></span></span> 代表了encoder的第j个输入与decoder的第i个输出的匹配程度。这里使用了类似于softmax的方法，把匹配程度转化为了概率来表示。<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;"></p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  说了这么多，个人对注意机制的理解就是在encoder-decoder结构中，在encoder把输入单词转化成向量的表示之后，每次对一个单词进行预测时，对encoder的输出赋予不同的权重，进行加权求和，再把其输入到编码器中。权重为0的位置，在此次预测时，我们便不关注，而对于那些权重值较大的位置，则是此次预测所关注的重点。这样也间接使C成为了可变长度的一个序列。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  注意机制有一个缺点：计算起来较为复杂，假设翻译的句子长度为50，那么你的权重矩阵的的参数个数应该为50*50=2500，这还不算太糟，但是当你如果按照字符来进行操作，此时你的权重矩阵就要处理数以百计的序列，此时注意机制的代价就十分昂贵。</p>



<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);font-weight:700;line-height:32px;word-break:break-all;"><a name="t2" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;"></a><strong style="outline:0px;box-sizing:border-box;font-weight:700;word-break:break-all;">3.tacotron结构分析</strong></h2>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  讲完encoder-decoder结构和注意机制之后，再来看看tacotron网络的结构，如下图所示：</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;"></p><center style="outline:0px;box-sizing:border-box;word-break:break-all;"><img src="TACOTRON端到端的语音合成 - CSDN博客_files/SouthEast [2]" type="image/png" data-filename="SouthEast" height="496" style="outline:0px;box-sizing:border-box;margin:24px 0px;word-break:break-all;max-width:100%;cursor:zoom-in;" title="" width="852"/></center><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;"></p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  左边的红框标记的是encoder模块，右边下半部分的红框是decoder模块，连接encoder模块和decoder模块的就是attention machanism，最后右边的上半部分是模型的post-processing net（后处理网络模块）。</p>



<h3 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:22px;color:rgb(79, 79, 79);font-weight:700;line-height:30px;word-break:break-all;"><a name="t3" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;"></a>3.1 encoder模块</h3>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  encoder模块主要是为了得到输入文本的一个很好的表示，encode的输入是将文本转换为one-hot向量，然后经过一个pre-net的网络结构，接着讲pre-net网络的输出输入到CBHG模块中，最后从CBHG中输出的就是输入的text的一个健壮的表示序列。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">下面分别对pre-net和CBHG的结构进行介绍。</p>



<h4 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:20px;color:rgb(79, 79, 79);font-weight:700;line-height:28px;word-break:break-all;"><strong style="outline:0px;box-sizing:border-box;font-weight:700;word-break:break-all;">3.1.1 pre-net结构</strong></h4>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  pre-net是一个3层的网络结构，其主要功能是对输入进行一系列的非线性的变换，这样有助于模型收敛和泛化。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  它有两个隐藏层，层与层之间的连接均是全连接；第一层的隐藏单元数目与输入单元数目一致，第二层的隐藏单元数目为第一层的一半；两个隐藏层采用的激活函数均为ReLu，并保持0.5的dropout来提高泛化能力。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">基于tensorflow实现prenet的代码：</p>



<pre style="margin:0px 0px 24px;word-break:break-all;overflow-y:hidden;overflow-x:auto;box-sizing:border-box;outline:0px;color:rgb(0, 0, 0);position:relative;font-family:Consolas, Inconsolata, Courier, monospace;font-size:14px;line-height:22px;padding:8px 16px 4px 56px;background-color:rgb(246, 248, 250);border:none;"><code style="font-size:14px;word-wrap:normal;outline:0px;display:block;padding:0px;color:rgb(0, 0, 0);font-family:Consolas, Inconsolata, Courier, monospace;box-sizing:border-box;line-height:22px;background-color:rgb(246, 248, 250);border-radius:4px;overflow-x:auto;white-space:pre;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">'''
inputs: 输入的tensor, 形状为[N, T, 256], 其中N为batch_size, T为输入文本的长度；
is_training: 布尔值, 表示是否为训练过程；
layer_size: 表示prenet一共有两层隐藏层，第一层有256个隐藏单元，第二层有128个隐藏单元
'''</span>
<span style="outline:0px;box-sizing:border-box;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">def</span> <span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">prenet</span><span style="outline:0px;box-sizing:border-box;color:rgb(79, 79, 79);word-break:break-all;">(inputs, is_training, layer_sizes=[<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">256</span>, <span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">128</span>], scope=None)</span>:</span>
    x = inputs
    <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># 定义dropout大小（只有在训练时才会dropout）</span>
    drop_rate = <span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">0.5</span> <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">if</span> is_training <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">else</span> <span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">0.0</span>
    <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">with</span> tf.variable_scope(scope <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">or</span> <span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">'prenet'</span>):
        <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># 循环两次，经过两个全连接层</span>
        <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">for</span> i, size <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">in</span> enumerate(layer_sizes):
            <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># 定义全连接层</span>
            dense = tf.layers.dense(x, units=size, activation=tf.nn.relu, name=<span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">'dense_%d'</span> % (i+<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">1</span>))
            <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># dropout</span>
            x = tf.layers.dropout(dense, rate=drop_rate, name=<span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">'dropout_%d'</span> % (i+<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">1</span>))
        <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># 输出x的形状为[N, T, 128]</span>
        <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">return</span> x</code><ul style="position:absolute;word-break:break-all;outline:0px;box-sizing:border-box;margin:0px;list-style:none;padding:8px 0px;width:48px;background-color:rgb(238, 240, 244);top:0px;left:0px;text-align:right;"><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">1</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">2</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">3</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">4</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">5</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">6</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">7</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">8</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">9</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">10</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">11</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">12</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">13</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">14</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">15</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">16</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">17</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">18</li></ul></pre>



<h4 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:20px;color:rgb(79, 79, 79);font-weight:700;line-height:28px;word-break:break-all;"><strong style="outline:0px;box-sizing:border-box;font-weight:700;word-break:break-all;">3.1.2 CBHG结构</strong></h4>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  CBHG结构最初源于机器翻译中，主要用于提高模型的泛化能力。它的结构如下图所示：</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;"></p><center style="outline:0px;box-sizing:border-box;word-break:break-all;"><img src="TACOTRON端到端的语音合成 - CSDN博客_files/SouthEast [3]" type="image/png" data-filename="SouthEast" height="481" style="outline:0px;box-sizing:border-box;margin:24px 0px;word-break:break-all;max-width:100%;cursor:zoom-in;" title="" width="468"/></center><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;"></p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  输入序列首先会经过一个卷积层，注意这个卷积层，它有K个大小不同的1维的filter，其中filter的大小为1,2,3…K。这些大小不同的卷积核提取了长度不同的上下文信息。然后，将经过不同大小的k个卷积核的输出堆积在一起（注意：在做卷积时，运用了padding，因此这k个卷积核输出的大小均是相同的）。下一层为最大池化层，stride为1，width为2。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  经过池化之后，会再经过两层一维的卷积层。第一个卷积层的filter大小为3，stride为1，采用的激活函数为ReLu；第二个卷积层的filter大小为3，stride为1，没有采用激活函数（在这两个一维的卷积层之间都会进行batch normalization）。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  经过卷积层之后，会进行一个residual connection。也就是把卷积层输出的和embeding之后的序列相加起来。然后输入到highway layers，highway nets的每一层结构为：把输入同时放入到两个一层的全连接网络中，这两个网络的激活函数分别采用了ReLu和sigmoid函数，假定输入为input，ReLu的输出为output1，sigmoid的输出为output2，那么highway layer的输出为：<span style="word-spacing:normal;word-break:break-all;outline:0px;display:inline;font-style:normal;font-weight:normal;line-height:normal;font-size:100%;text-indent:0px;text-align:left;text-transform:none;letter-spacing:normal;box-sizing:border-box;word-wrap:normal;white-space:nowrap;float:none;direction:ltr;max-width:none;max-height:none;min-width:0px;min-height:0px;border:0px;padding:0px;margin:0px;position:relative;"><span style="max-height:none;transition:none;outline:0px;box-sizing:border-box;min-height:0px;padding:0px;max-width:none;border:0px;min-width:0px;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;white-space:nowrap;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:27.607em;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:relative;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:22.971em;height:0px;font-size:120%;"><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:absolute;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;clip:rect(1.201em, 1022.97em, 2.503em, -999.997em);top:-2.133em;left:0em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">o</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">u</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">t</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">p</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">u</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">t</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.263em;">=</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;padding-left:0.263em;">o</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">u</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">t</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">p</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">u</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">t</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;">1</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.211em;">∗</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;padding-left:0.211em;">o</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">u</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">t</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">p</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">u</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">t</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;">2</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.211em;">+</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;padding-left:0.211em;">i</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">n</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">p</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">u</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">t</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.211em;">∗</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;padding-left:0.211em;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="vertical-align:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;font-family:STIXGeneral, &quot;Arial Unicode MS&quot;, serif;font-size:83%;font-style:normal;font-weight:normal;">（</span></span></span></span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;">1</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;padding-left:0.211em;">−</span><span style="margin:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;padding-left:0.211em;">o</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">u</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">t</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">p</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">u</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Math-italic;">t</span><span style="padding:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;box-sizing:border-box;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;font-family:MathJax_Main;">2</span><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="padding:0px;transition:none;outline:0px;box-sizing:border-box;position:static;border:0px;display:inline;margin:0px;vertical-align:0px;line-height:normal;text-decoration:none;word-break:break-all;"><span style="vertical-align:0px;word-break:break-all;outline:0px;display:inline;position:static;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;font-family:STIXGeneral, &quot;Arial Unicode MS&quot;, serif;font-size:83%;font-style:normal;font-weight:normal;">）</span></span></span></span></span><span style="margin:0px;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;box-sizing:border-box;vertical-align:0px;line-height:normal;text-decoration:none;transition:none;width:0px;height:2.138em;"></span></span></span><span style="vertical-align:-0.309em;word-break:break-all;outline:0px;display:inline-block;position:static;border:0px;padding:0px;margin:0px;box-sizing:border-box;line-height:normal;text-decoration:none;transition:none;overflow:hidden;border-left:0px solid;width:0px;height:1.316em;"></span></span></span><span style="border:0px;transition:none;outline:0px;top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);user-select:none;box-sizing:border-box;display:block;word-break:break-all;text-decoration:none;line-height:normal;vertical-align:0px;margin:0px;position:absolute;overflow:hidden;width:1px;height:1px;padding:1px 0px 0px;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">o</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">u</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">p</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">u</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">=</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">o</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">u</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">p</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">u</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">1</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">∗</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">o</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">u</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">p</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">u</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">2</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">+</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">i</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">n</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">p</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">u</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">∗</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">（</span></span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">1</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">−</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">o</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">u</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">p</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">u</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">t</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">2</span><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;transition:none;word-break:break-all;">）</span></span></span></span></span>，文章中使用了4层highway layer。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">highway layer的实现代码：</p>



<pre style="margin:0px 0px 24px;word-break:break-all;overflow-y:hidden;overflow-x:auto;box-sizing:border-box;outline:0px;color:rgb(0, 0, 0);position:relative;font-family:Consolas, Inconsolata, Courier, monospace;font-size:14px;line-height:22px;padding:8px 16px 4px 56px;background-color:rgb(246, 248, 250);border:none;"><code style="font-size:14px;word-wrap:normal;outline:0px;display:block;padding:0px;color:rgb(0, 0, 0);font-family:Consolas, Inconsolata, Courier, monospace;box-sizing:border-box;line-height:22px;background-color:rgb(246, 248, 250);border-radius:4px;overflow-x:auto;white-space:pre;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">def</span> <span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">highwaynet</span><span style="outline:0px;box-sizing:border-box;color:rgb(79, 79, 79);word-break:break-all;">(inputs, scope)</span>:</span>
    <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">with</span> tf.variable_scope(scope):
        <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># 定义一个使用 ReLu 为激活函数的全连接层，包含128个隐藏单元</span>
        H = tf.layers.dense(
          inputs,
          units=<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">128</span>,
          activation=tf.nn.relu,
          name=<span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">'H'</span>)
        <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># 定义一个使用 sigmoid 为激活函数的全连接层，包含128个隐藏单元</span>
        T = tf.layers.dense(
          inputs,
          units=<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">128</span>,
          activation=tf.nn.sigmoid,
          name=<span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">'T'</span>,
          bias_initializer=tf.constant_initializer(-<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">1.0</span>))
        <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># 返回 highway layer 的输出</span>
        <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">return</span> H * T + inputs * (<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">1.0</span> - T)</code><ul style="position:absolute;word-break:break-all;outline:0px;box-sizing:border-box;margin:0px;list-style:none;padding:8px 0px;width:48px;background-color:rgb(238, 240, 244);top:0px;left:0px;text-align:right;"><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">1</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">2</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">3</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">4</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">5</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">6</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">7</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">8</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">9</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">10</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">11</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">12</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">13</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">14</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">15</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">16</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">17</li></ul></pre>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  最后将highway net的输出输入到双向RNN当中，从RNN中输出的结果就是encoder的输出。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">基于tensorflow实现CBHG的代码：</p>



<pre style="margin:0px 0px 24px;word-break:break-all;overflow-y:hidden;overflow-x:auto;box-sizing:border-box;outline:0px;color:rgb(0, 0, 0);position:relative;font-family:Consolas, Inconsolata, Courier, monospace;font-size:14px;line-height:22px;padding:8px 16px 4px 56px;background-color:rgb(246, 248, 250);border:none;"><code style="font-size:14px;word-wrap:normal;outline:0px;display:block;padding:0px;color:rgb(0, 0, 0);font-family:Consolas, Inconsolata, Courier, monospace;box-sizing:border-box;line-height:22px;background-color:rgb(246, 248, 250);border-radius:4px;overflow-x:auto;white-space:pre;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">'''
inputs: 输入的tensor(也是prenet的输出), 形状为[N, T, 128], 其中N为batch_size, T为输入文本的长度；
input_lengths: 输入的文本的长度；形状为[N], 代表一个batch中每一条文本的长度组成的向量, N代表batch_size；
is_training: 布尔值, 表示是否为训练过程；
K: int型, 表示第一层卷积里卷积核的个数；
projections: 代表第二个卷积层中每次卷积之后输出的长度
'''</span>
<span style="outline:0px;box-sizing:border-box;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">def</span> <span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">cbhg</span><span style="outline:0px;box-sizing:border-box;color:rgb(79, 79, 79);word-break:break-all;">(inputs, input_lengths, is_training, scope, K, projections)</span>:</span>
    <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">with</span> tf.variable_scope(scope):
        <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">with</span> tf.variable_scope(<span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">'conv_bank'</span>):
            <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># Convolution bank: concatenate on the last axis to stack channels from all convolutions</span>
            <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># 通过concat把k个卷积的feature map堆起来，输出形状为[N, T, k*128]</span>
            conv_outputs = tf.concat(
              [conv1d(inputs, k, <span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">128</span>, tf.nn.relu, is_training, <span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">'conv1d_%d'</span> % k) <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">for</span> k <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">in</span> range(<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">1</span>, K+<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">1</span>)],
              axis=-<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">1</span>
            )

        <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># Maxpooling: 输出形状为[N, T, k*128]</span>
        maxpool_output = tf.layers.max_pooling1d(
          conv_outputs,
          pool_size=<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">2</span>,
          strides=<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">1</span>,
          padding=<span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">'same'</span>)

        <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># 两个卷积层, 3代表卷积核的大小, 这里projections为[128, 128], 输出形状为[N, T, 128]</span>
        proj1_output = conv1d(maxpool_output, <span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">3</span>, projections[<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">0</span>], tf.nn.relu, is_training, <span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">'proj_1'</span>)
        proj2_output = conv1d(proj1_output, <span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">3</span>, projections[<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">1</span>], <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">None</span>, is_training, <span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">'proj_2'</span>)

        <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># Residual connection: 将经过卷积层的输出和prenet的输出求和</span>
        highway_input = proj2_output + inputs

        <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># 处理highway net输出不匹配的情况，通过一个全连接层把输出变成[N, T, 128]</span>
        <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">if</span> highway_input.shape[<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">2</span>] != <span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">128</span>:
            highway_input = tf.layers.dense(highway_input, <span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">128</span>)

        <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># 4-layer HighwayNet:</span>
        <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">for</span> i <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">in</span> range(<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">4</span>):
            highway_input = highwaynet(highway_input, <span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);word-break:break-all;">'highway_%d'</span> % (i+<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">1</span>))
        rnn_input = highway_input

        <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># Bidirectional RNN</span>
        outputs, states = tf.nn.bidirectional_dynamic_rnn(
          GRUCell(<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">128</span>),
          GRUCell(<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">128</span>),
          rnn_input,
          sequence_length=input_lengths,
          dtype=tf.float32)
        <span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);word-break:break-all;">return</span> tf.concat(outputs, axis=<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);word-break:break-all;">2</span>)  <span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);word-break:break-all;"># Concat forward and backward</span></code><ul style="position:absolute;word-break:break-all;outline:0px;box-sizing:border-box;margin:0px;list-style:none;padding:8px 0px;width:48px;background-color:rgb(238, 240, 244);top:0px;left:0px;text-align:right;"><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">1</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">2</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">3</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">4</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">5</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">6</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">7</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">8</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">9</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">10</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">11</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">12</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">13</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">14</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">15</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">16</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">17</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">18</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">19</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">20</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">21</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">22</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">23</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">24</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">25</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">26</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">27</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">28</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">29</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">30</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">31</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">32</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">33</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">34</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">35</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">36</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">37</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">38</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">39</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">40</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">41</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">42</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">43</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">44</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">45</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">46</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">47</li><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">48</li></ul></pre>



<h3 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:22px;color:rgb(79, 79, 79);font-weight:700;line-height:30px;word-break:break-all;"><a name="t4" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;"></a>3.2 decoder模块</h3>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  decoder模块主要分为三部分：pre-net、Attention-RNN、Decoder-RNN。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  pre-net的结构与encoder中的pre-net相同，主要是对输入做一些非线性变换。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  Attention-RNN的结构为一层包含256个GRU的RNN，它将pre-net的输出和attention的输出作为输入，经过GRU单元后输出到decoder-RNN中。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  decode-RNN为两层residual GRU，它的输出为输入与经过GRU单元输出之和。每层同样包含了256个GRU单元。第一步decoder的输入为0矩阵，之后都会把第t步的输出作为第t+1步的输入。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">注意：由于每个字符在发音的时候，可能对应了多个帧，因此每个GRU单元输出为多个帧的音频文件，paper上说在decoder的每一步时，不仅仅预测1帧的数据，而是预测多个费重叠的帧。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  这样的好处有：</p>

<ol style="outline:0px;list-style:none;box-sizing:border-box;padding:0px;margin:0px 0px 24px;word-break:break-all;">
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;"><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">减少了训练模型的大小；</p></li>
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;"><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">减少了训练的时间；</p></li>
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;"><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">可以提高收敛的速度。</p></li>
</ol>



<h3 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:22px;color:rgb(79, 79, 79);font-weight:700;line-height:30px;word-break:break-all;"><a name="t5" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;"></a>3.3 post-processing模块</h3>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  在decoder-RNN输出之后并没有直接将输出转化为音频文件，而是又添加了后处理的网络。后处理的网络可以在一个线性频率范围内预测幅度谱（spectral magnitude），并且后处理网络能看到整个解码的序列，而不像seq2seq那样，只能从左至右的运行。后处理网络可以通过反向传播来修正每一帧的错误。paper中使用了CBHG的结构来作为post-processing net。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  最后使用Griffin-Lim算法来将post-processing net的输出合成为语音。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">  文章的部分超参数和网络结构如下图所示： <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
</p><center style="outline:0px;box-sizing:border-box;word-break:break-all;"><img src="TACOTRON端到端的语音合成 - CSDN博客_files/SouthEast [4]" type="image/png" data-filename="SouthEast" height="573" style="outline:0px;box-sizing:border-box;margin:24px 0px;word-break:break-all;max-width:100%;cursor:zoom-in;" title="" width="655"/></center><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;"></p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">关于tacotron的介绍就到这里啦，欢迎各位指点~~</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">附上使用tensorflow实现的<a href="https://github.com/zuoxiang95/tacotron-1" rel="nofollow" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;" target="_blank">tacotron</a>的地址。</p>

<hr style="outline:0px;box-sizing:border-box;margin:24px 0px;border-top:none;border-right:none;border-left:none;border-image:initial;border-bottom:1px solid rgb(221, 221, 221);word-break:break-all;"/>



<h3 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:22px;color:rgb(79, 79, 79);font-weight:700;line-height:30px;word-break:break-all;"><a name="t6" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;"></a>附录</h3>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">在这里记录一下我训练tacotron模型的一些坑，希望能对大家有所帮助吧！</p>

<ol style="outline:0px;list-style:none;box-sizing:border-box;padding:0px;margin:0px 0px 24px;word-break:break-all;">
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;">训练速度：在开始的时候，人很傻，直接拿音频文件来进行训练。因为模型训练不是直接拿音频作为输入进行训练，而在之前还对音频进行了一些计算过程。因此在训练时，每次一次输入音频都要做一次计算才输入到我们的网络中。后来参考github上的一些人的建议，提前将音频处理好，输出为.npy文件。然后再在训练时将.npy文件，然后采用队列的形式，一次读入一个batch的数据传给GPU。这样训练速度相比之前拿音频进行训练提升了20%左右；</li>
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;">数据的预处理：在训练英文的tacotron时，会发现有一些英文的缩写，但是发音还是按照完整的单词来读的，比如：Mr，Dc等等。因此在训练之前要将一些常用的英文缩写还原成对应的单词；还有就是对于阿拉伯数字和一些符号比如”$”、”.”，我们也要将其还原成对应的单词；</li>
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;">静音的处理：在训练之前，需要对音频文件去除其开头与结尾部分的静音。这样做对模型训练的收敛速度有很大的提升；</li>
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;">输入文本中的符号的处理：tacotron模型时可以学习出标点符号的停顿和发音的，因此我们保留了几个常用的标点符号，将其与单词一样embedding我词向量输入到网络中；</li>
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;">使用音素进行训练：在训练完tacotron后，我还尝试了使用英文的音素进行训练，也就是将英文单词转化为英文的音素。发现训练同样的轮数，使用英文的音素训练处的模型的效果要比英文单词要好；</li>
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;">在训练过程中会产生梯度爆炸的现象：不知道是attention机制的弊端还是怎么地的，在训练过程中偶尔会出现梯度爆炸的现象，虽然在之后loss还是会降下来，但是这样浪费了大量的训练时间，因此在优化的时候采用clipped_gradient，这样可以有效的避免梯度爆炸或者梯度消失的现象；</li>
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;">对于合成较长的音频，模型效果并不是太好：这是因为我们训练集的音频长度都是在1s-10s之间。所以在对于较长的文本，末尾部分的发音可能不太好。有两种方法解决这个问题，第一种就是在数据集中添加较长的文本和音频进行训练；第二种方法你可以在测试的时候对文本进行判断，但文本长度较长时，可以按照符号进行切割，分成好几个部分进行预测，最后再拼接起来。第二种方法在拼接处可能听起来会不太自然。</li>
<li style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;list-style-type:decimal;margin-left:40px;margin-top:8px;word-break:break-all;">最近去jd面试，他们也在使用这个模型做语音合成。对于语音合成，他们想要做实时合成。而使用的Griffin-Lim是基于CPU实现的，进行合成还没有到达实时的地步。一个想法是使用百度DeepVoice里的使用wavenet代替Griffin-Lim算法合成语音。另一个是写一个基于GPU的Griffin-Lim合成算法。</li>
</ol>            </div>

                <span style="display:block;clear:both;"></span></div>

        	</div>

		<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;padding-bottom:16px;margin-top:16px;border-bottom:1px solid rgb(227, 227, 227);">
				<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-size:12px;color:rgb(153, 153, 153);">
			版权声明：本文为博主原创文章，未经博主允许不得转载。			https://blog.csdn.net/Left_Think/article/details/74905928		</div>
						<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;margin-bottom:8px;font-size:12px;margin-top:8px;">
			<span style="box-sizing:inherit;outline:0px;color:rgb(77, 77, 77);">文章标签：</span>
						<a href="http://so.csdn.net/so/search/s.do?q=%E8%AF%AD%E9%9F%B3%E5%90%88%E6%88%90&amp;t=blog" style="color:rgb(77, 77, 77);cursor:pointer;text-decoration:none;outline:0px;box-sizing:inherit;display:inline-block;word-break:break-all;border:1px solid rgb(204, 204, 204);border-radius:100px;padding:0px 8px;text-align:center;line-height:24px;min-width:24px;height:24px;margin-right:8px;" target="_blank">语音合成						</a><a href="http://so.csdn.net/so/search/s.do?q=%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB&amp;t=blog" style="color:rgb(77, 77, 77);cursor:pointer;text-decoration:none;outline:0px;box-sizing:inherit;display:inline-block;word-break:break-all;border:1px solid rgb(204, 204, 204);border-radius:100px;padding:0px 8px;text-align:center;line-height:24px;min-width:24px;height:24px;margin-right:8px;" target="_blank">语音识别						</a>
		</div>
						<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-size:12px;margin-bottom:0px;">
			<span style="box-sizing:inherit;outline:0px;color:rgb(77, 77, 77);">个人分类：</span>
						<a href="https://blog.csdn.net/left_think/article/category/7016386" style="box-sizing:inherit;outline:0px;text-decoration:none;cursor:pointer;display:inline-block;margin-right:24px;color:rgb(121, 165, 229);word-break:break-all;" target="_blank">深度学习						</a>
		</div>
							</div>


			<div style="outline:0px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;margin:0px;box-sizing:inherit;padding:0px;line-height:28px;display:inline-block;width:48%;margin-top:18px;margin-right:16px;">
		<a href="https://blog.csdn.net/left_think/article/details/53412626" style="box-sizing:inherit;outline:0px;color:rgb(51, 51, 51);text-decoration:none;cursor:pointer;">
			<span style="box-sizing:inherit;outline:0px;margin-right:8px;padding:6px 8px;font-size:12px;border:1px solid rgb(227, 227, 227);color:rgb(77, 77, 77);">上一篇</span>spark中查询PG数据库老是报无法找到该列		</a>
	</div>
				<div style="outline:0px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;margin:0px;box-sizing:inherit;padding:0px;line-height:28px;display:inline-block;width:48%;margin-bottom:0px;margin-top:0px;">
		<a href="https://blog.csdn.net/left_think/article/details/75577512" style="box-sizing:inherit;outline:0px;color:rgb(51, 51, 51);text-decoration:none;cursor:pointer;">
			<span style="box-sizing:inherit;outline:0px;margin-right:8px;padding:6px 8px;font-size:12px;border:1px solid rgb(227, 227, 227);color:rgb(77, 77, 77);">下一篇</span>Deep Speech：端到端的语音识别		</a>
	</div>
	</div></span></div></div></div></div>
</div>
</span>
</div>


</body>
</html>
